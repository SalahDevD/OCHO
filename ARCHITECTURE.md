# ğŸ—ï¸ Architecture OCHO - Vue d'Ensemble

## ğŸ“ Diagramme SystÃ¨me

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (HTML/JS)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚   Login      â”‚  â”‚  Dashboard   â”‚  â”‚   Pages      â”‚           â”‚
â”‚  â”‚   Form       â”‚  â”‚   Stats      â”‚  â”‚   CRUD       â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ HTTP/JSON
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXPRESS API SERVER (Node.js)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      Middleware Layer                       â”‚ â”‚
â”‚  â”‚  â€¢ CORS  â€¢ JSON Parser  â€¢ JWT Verification  â€¢ Role Check   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  Auth        â”‚  Products    â”‚  Clients     â”‚                â”‚
â”‚  â”‚  Routes      â”‚  Routes      â”‚  Routes      â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚         â†“              â†“              â†“                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  Auth        â”‚  Product     â”‚  Client      â”‚                â”‚
â”‚  â”‚  Controller  â”‚  Controller  â”‚  Controller  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚         â†“              â†“              â†“                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  Commande    â”‚  Dashboard   â”‚  DB Query    â”‚                â”‚
â”‚  â”‚  Routes      â”‚  Routes      â”‚  Layer       â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ MySQL Protocol
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MYSQL DATABASE (XAMPP)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ocho_db                                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚
â”‚  â”‚  â”‚Utilisat.â”‚  â”‚ Produits â”‚  â”‚ Clients    â”‚              â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚
â”‚  â”‚  â”‚Commandesâ”‚  â”‚Variantes â”‚  â”‚ CatÃ©gories â”‚              â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚
â”‚  â”‚  â”‚DÃ©tails  â”‚  â”‚Roles     â”‚  â”‚ LogsSyst.  â”‚              â”‚  â”‚
â”‚  â”‚  â”‚Commandesâ”‚  â”‚          â”‚  â”‚            â”‚              â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flux d'Authentification

```
1. Utilisateur remplit login
   â†“
2. Frontend envoie POST /api/auth/login
   â†“
3. Backend vÃ©rifie email + mot de passe
   â”œâ”€ RÃ©cupÃ¨re utilisateur en BD
   â”œâ”€ Compare mot de passe avec bcrypt
   â””â”€ RÃ©cupÃ¨re le rÃ´le
   â†“
4. CrÃ©e JWT token (valide 24h)
   â†“
5. Retourne {token, user}
   â†“
6. Frontend sauvegarde token en localStorage
   â†“
7. RequÃªtes suivantes incluent: Authorization: Bearer TOKEN
   â†“
8. Middleware vÃ©rifie et dÃ©code le token
   â†“
9. Extrait les infos utilisateur (id, role)
   â†“
10. Middleware roleMiddleware vÃ©rifie les permissions
    â†“
11. Route traitÃ©e si authentifiÃ© + autorisÃ©
```

---

## ğŸ“Š SchÃ©ma Base de DonnÃ©es

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  Utilisateur â”‚
                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                        â”‚ id (PK)     â”‚
                        â”‚ nom         â”‚
                        â”‚ email       â”‚
                        â”‚ mot_passe   â”‚
                        â”‚ role_id (FK)â”‚
                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“                   â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Commande        â”‚  â”‚   Role      â”‚
          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚ id (PK)          â”‚  â”‚ id (PK)     â”‚
          â”‚ client_id (FK)   â”‚  â”‚ nom         â”‚
          â”‚ utilisateur_id   â”‚  â”‚ description â”‚
          â”‚ (FK)             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ statut           â”‚
          â”‚ date_commande    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ DetailCommande   â”‚
          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚ id (PK)          â”‚
          â”‚ commande_id (FK) â”‚
          â”‚ variante_id (FK) â”‚
          â”‚ quantite         â”‚
          â”‚ prix_unitaire    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   Variante       â”‚
          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚ id (PK)          â”‚
          â”‚ produit_id (FK)  â”‚
          â”‚ taille           â”‚
          â”‚ couleur          â”‚
          â”‚ quantite         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†‘
                   â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â†‘                   â†‘
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Produit    â”‚   â”‚  Client     â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚ id (PK)     â”‚   â”‚ id (PK)     â”‚
     â”‚ reference   â”‚   â”‚ nom         â”‚
     â”‚ nom         â”‚   â”‚ prenom      â”‚
     â”‚ categorie   â”‚   â”‚ email       â”‚
     â”‚ prix_vente  â”‚   â”‚ telephone   â”‚
     â”‚ prix_achat  â”‚   â”‚ adresse     â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Categorie   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚ id (PK)     â”‚
     â”‚ nom         â”‚
     â”‚ description â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Flux de SÃ©curitÃ©

```
RequÃªte ArrivÃ©e
    â†“
Middleware CORS (AccÃ¨s cross-origin)
    â†“
Body Parser (JSON)
    â†“
Route AuthentifiÃ©e? (public/protected)
    â”œâ”€ PUBLIC: /api/auth/login, /api/auth/register
    â”‚  â””â”€ Pas de vÃ©rification
    â”‚
    â””â”€ PROTECTED: Autres routes
       â”œâ”€ RÃ©cupÃ¨re header Authorization
       â”œâ”€ Extrait token (Bearer TOKEN)
       â”œâ”€ VÃ©rifie signature JWT
       â”œâ”€ DÃ©crypte donnÃ©es utilisateur
       â”œâ”€ VÃ©rifie expiration
       â””â”€ Ajoute user Ã  req (req.user.id, req.user.role)
          â†“
       VÃ©rification RÃ´le?
       â”œâ”€ checkRole('Administrateur') ?
       â”œâ”€ checkRole('Magasinier') ?
       â””â”€ checkRole('Vendeur') ?
          â†“
       Permission AccordÃ©e? 
       â”œâ”€ OUI â†’ Traite la requÃªte
       â”‚        â†“
       â”‚        AccÃ¨s BD
       â”‚        â†“
       â”‚        Retour rÃ©sultat
       â”‚
       â””â”€ NON â†’ Erreur 403 (Forbidden)
```

---

## ğŸ“‹ Cycle de Vie d'une RequÃªte

### Exemple: CrÃ©er un Produit

```
1. Frontend
   â”œâ”€ RÃ©cupÃ¨re token de localStorage
   â””â”€ POST /api/products
      Content-Type: application/json
      Authorization: Bearer TOKEN
      {
        "reference": "PROD001",
        "nom": "T-Shirt",
        ...
      }

2. Express
   â”œâ”€ CORS Middleware (OK)
   â”œâ”€ JSON Parser (OK)
   â”œâ”€ Route: POST /api/products
   â”‚  â””â”€ authMiddleware
   â”‚     â”œâ”€ VÃ©rifie header Authorization (OK)
   â”‚     â”œâ”€ Extrait token
   â”‚     â”œâ”€ VÃ©rifie JWT (OK)
   â”‚     â””â”€ Ajoute req.user = {id:1, role:"Administrateur"}
   â”‚
   â”œâ”€ checkRole Middleware
   â”‚  â”œâ”€ VÃ©rifie req.user.role
   â”‚  â”œâ”€ Cherche si "Administrateur" en allowedRoles
   â”‚  â””â”€ OK â†’ next()
   â”‚
   â””â”€ productController.createProduct()
      â”œâ”€ Valide donnÃ©es
      â”œâ”€ PrÃ©pare INSERT SQL
      â”œâ”€ ExÃ©cute query BD
      â”œâ”€ RÃ©cupÃ¨re insertId
      â”œâ”€ CrÃ©e variantes si fournis
      â””â”€ Retourne {success: true, productId: 5}

3. BD (MySQL)
   â”œâ”€ INSERT INTO Produit ...
   â”œâ”€ INSERT INTO Variante ... (x2)
   â””â”€ COMMIT

4. Frontend
   â”œâ”€ ReÃ§oit rÃ©ponse JSON
   â”œâ”€ Affiche message succÃ¨s
   â””â”€ RafraÃ®chit la liste
```

---

## ğŸ¯ Points ClÃ©s du Design

âœ… **Separation of Concerns**
- Controllers pour la logique
- Routes pour le routage
- Middleware pour la sÃ©curitÃ©

âœ… **SÃ©curitÃ© en Couches**
- CORS contrÃ´lÃ©
- Authentification JWT
- Autorisation par rÃ´le
- Validation des donnÃ©es

âœ… **Gestion d'Erreurs**
- Try/catch dans les controllers
- Messages d'erreur clairs
- Codes HTTP appropriÃ©s

âœ… **Performance**
- Connection pooling BD
- Indexes sur les clÃ©s Ã©trangÃ¨res
- Vues SQL optimisÃ©es

âœ… **Logging**
- LogsSysteme table
- Actions enregistrÃ©es
- TraÃ§abilitÃ© complÃ¨te

---

## ğŸš€ DÃ©ploiement

```
Code Local â†’ Git Push â†’ Server
                â†“
          npm install
                â†“
          .env (variables sÃ©curisÃ©es)
                â†“
          MySQL Setup
                â†“
          npm start
                â†“
          Accessible via HTTPS
```

---

**Architecture robuste et extensible pour la production âœ…**
